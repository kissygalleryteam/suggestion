/*!build time : 2014-11-14 5:52:04 PM*/
KISSY.add("kg/suggestion/0.0.1/index",["./index.css","node","base","io"],function(a,b){b("./index.css");var c=b("node").all,d=b("base"),e=b("io"),f={trigger:"",width:105,source:"",mapKey:"key",mapValue:"value"},g=function(a){var b=this;g.superclass.constructor.call(b,a),b.init(a)};return a.extend(g,d,{init:function(b){var c=this;c.config=a.merge({},f,b),this._render(),this._bindEvent()},selectValue:"",_render:function(){var a=this,b=a.config;this.$input=c(b.trigger);var d=b.width;this.$list=c("<ul>").addClass("tbc-suggestion-list"),this.$tbcSuggestion=c('<div class="tbc-suggestion">').css("width",d+"px").appendTo("body"),this.$tbcSuggestion.append(this.$list)},_position:function(a){for(var b={x:0,y:0};a;a=a.offsetParent)b.x+=a.offsetLeft,b.y+=a.offsetTop;return{left:b.x,top:b.y}},_setPosition:function(){var a=this,b=c(a.config.trigger),d=a._position(b[0]),e=parseInt(d.left,10),f=parseInt(d.top,10);f+=b.outerHeight(),a.$tbcSuggestion.css({left:e,top:f})},_bindEvent:function(){var a=this;a.$input.on("focus",function(){a._setPosition()}),a.$input.on("keyup",function(){a.query()}),a.$input.on("mouseenter",function(){a.isblank=!1}).on("mouseleave",function(){a.isblank=!0}),c(document.body).on("click",function(){a.isblank&&a.$tbcSuggestion.slideUp(.2)})},query:function(){var b=this,d=b.config.mapKey,f=b.config.mapValue,g=!1,h=b.$input.val().toLowerCase();if(0!==h.length){var i=[];new e({url:b.config.source+encodeURIComponent(h),type:"get",dataType:"json",success:function(e){if(e.length){g=!0;for(var h in e)i.push([e[h][d],e[h][f]])}if(g){b.$list.html("");for(var j in i){var k=i[j];if(c('<li _value="'+k[0]+'">'+k[1]+"</li>").appendTo(b.$list),j>=9)break}b.$tbcSuggestion.css("display","block"),c("li",b.$list).detach("click"),c("li",b.$list).on("click",function(){var c=a.one(this),d=c.attr("_value"),e=c.text();b.$tbcSuggestion.slideToggle(.2),b.setValue(d),b.setInput(e)})}},error:function(){alert("\u540e\u7aef\u670d\u52a1\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")}})}},setInput:function(a){this.$input.val(a)},setValue:function(a){this.$input.attr("_val",a),this.selectValue=a},getValue:function(){return this.selectValue}}),g});